<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    <%= title %> | PaduKarya
  </title>
  <%- include("../../_style") %>
</head>

<body>
  <div id="main-wrapper" data-theme="light" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full" data-sidebar-position="fixed" data-header-position="fixed" data-boxed-layout="full">
    <%- include("../../_header") %>
    <%- include("../../_sidebar", {page: 'kontrak'}) %>
    <%- include("../../_toast") %>

    <div class="page-wrapper">
      <%- include("_breadcrumb", {title: "Informasi Kontrak", kontrak: kontrak}) %>
      
      <div class="container-fluid">
        <div class="row">
          <div class="col-3">
            <%- include('_sidebar', {page: 'detail', kontrak: kontrak}) %>
          </div>
          <div class="col-9">
            <div class="card">
              <div class="card-body">
                <h4 style="font-weight: 500;">Informasi</h4>
                <hr>
                <form action="/kontrak/<%= kontrak._id %>" method="POST">
                  <input type="hidden" name="token" value="<%= token %>">
    
                  <div class="mb-4">
                    <label for="" class="form-label">Tahun</label>
                    <input type="number" name="tahun" id="" class="form-control" style="max-width: 220px;" value="<%= kontrak.tahun %>" <%= kontrak.is_amandemen ? '' : 'disabled' %>>
                    <% if(errors) { %>
                      <div class="text-danger mt-2 text-sm">
                        <%= errors.tahun %>
                      </div>
                    <% } %>
                  </div>
    
                  <div class="mb-4">
                    <label for="" class="form-label">Basket</label>
                    <select name="basket" id="" class="form-control" style="max-width: 220px;" <%= kontrak.is_amandemen ? '' : 'disabled' %>>
                      <option value="">Pilih basket</option>
                      <option value="1" <%= kontrak.basket == 1 ? 'selected' : '' %>>1</option>
                      <option value="2" <%= kontrak.basket == 2 ? 'selected' : '' %>>2</option>
                      <option value="3" <%= kontrak.basket == 3 ? 'selected' : '' %>>3</option>
                    </select>
                    <% if(errors) { %>
                      <div class="text-danger mt-2 text-sm">
                        <%= errors.basket %>
                      </div>
                    <% } %>
                  </div>
    
                  <div class="mb-4">
                    <label for="" class="form-label">Pilih Pengadaan</label>
                    <select class="form-select" name="" id="pengadaan-select2" data-placeholder="Pilih Pengadaan" disabled></select>
                  </div>
    
                  <div class="mb-4">
                    <label for="" class="form-label">Nomor Kontrak</label>
                    <input type="text" class="form-control" name="nomor_kontrak" value="<%= kontrak.nomor_kontrak %>" <%= kontrak.is_amandemen ? '' : 'disabled' %>>
                    <% if(errors) { %>
                      <div class="text-danger mt-2 text-sm">
                        <%= errors.nomor_kontrak %>
                      </div>
                    <% } %>
                  </div>

                  <div class="mb-4">
                    <label for="" class="form-label">Nomor PO</label>
                    <input type="text" class="form-control" name="nomor_po" value="<%= kontrak.nomor_po %>" <%= kontrak.is_amandemen ? '' : 'disabled' %>>
                    <% if(errors) { %>
                      <div class="text-danger mt-2 text-sm">
                        <%= errors.nomor_po %>
                      </div>
                    <% } %>
                  </div>
    
                  <div class="mb-4">
                    <label for="" class="form-label">Tanggal Kontrak</label>
                    <input type="date" name="tanggal_kontrak" id="" class="form-control" value="<%= kontrak.tanggal_kontrak %>" <%= kontrak.is_amandemen ? '' : 'disabled' %>>
                    <% if(errors) { %>
                      <div class="text-danger mt-2 text-sm">
                        <%= errors.tanggal_kontrak %>
                      </div>
                    <% } %>
                  </div>
    
                  <div class="mb-4">
                    <label for="" class="form-label">Tanggal Awal</label>
                    <input type="date" name="tanggal_awal" id="" class="form-control" value="<%= kontrak.tanggal_awal %>" <%= kontrak.is_amandemen ? '' : 'disabled' %>>
                    <% if(errors) { %>
                      <div class="text-danger mt-2 text-sm">
                        <%= errors.tanggal_awal %>
                      </div>
                    <% } %>
                  </div>
    
                  <div class="mb-4">
                    <label for="" class="form-label">Tanggal Akhir</label>
                    <input type="date" name="tanggal_akhir" id="" class="form-control" value="<%= kontrak.tanggal_akhir %>" <%= kontrak.is_amandemen ? '' : 'disabled' %>>
                    <% if(errors) { %>
                      <div class="text-danger mt-2 text-sm">
                        <%= errors.tanggal_akhir %>
                      </div>
                    <% } %>
                  </div>
    
                  <div class="mb-4">
                    <label for="" class="form-label">Pelaksana</label>
                    <input type="text" name="pelaksana" id="" class="form-control" value="<%= kontrak.pelaksana %>" <%= kontrak.is_amandemen ? '' : 'disabled' %>>
                    <% if(errors) { %>
                      <div class="text-danger mt-2 text-sm">
                        <%= errors.pelaksana %>
                      </div>
                    <% } %>
                  </div>
    
                  <div class="mb-4">
                    <label for="" class="form-label">Direksi</label>
                    <select name="direksi" id="" class="form-control" style="max-width: 220px;" <%= kontrak.is_amandemen ? '' : 'disabled' %>>
                      <option value="">Pilih Direksi</option>
                      <option value="perencanaan" <%= kontrak.direksi == 'perencanaan' ? 'selected' : '' %>>Perencanaan</option>
                      <option value="konstruksi" <%= kontrak.direksi == 'konstruksi' ? 'selected' : '' %> >Konstruksi</option>
                      <option value="jaringan" <%= kontrak.direksi == 'jaringan' ? 'selected' : '' %>>Jaringan</option>
                      <option value="traksaksi_energi" <%= kontrak.direksi == 'traksaksi_energi' ? 'selected' : '' %>>Transaksi Energi</option>
                      <option value="niaga" <%= kontrak.direksi == 'niaga' ? 'selected' : '' %>>Niaga</option>
                      <option value="pemasaran" <%= kontrak.direksi == 'pemasaran' ? 'selected' : '' %>>Pemasaran</option>
                      <option value="keuangan_dan_umum" <%= kontrak.direksi == 'keuangan_dan_umum' ? 'selected' : '' %>>Keuangan dan Umum</option>
                      <option value="k3l" <%= kontrak.direksi == 'k3l' ? 'selected' : '' %>>K3L</option>
                    </select>
                    <% if(errors) { %>
                      <div class="text-danger mt-2 text-sm">
                        <%= errors.status %>
                      </div>
                    <% } %>
                  </div>
    
                  <div class="mb-4">
                    <label for="" class="form-label">Tipe</label>
                    <select name="type" id="" class="form-control" style="max-width: 220px;" <%= kontrak.is_amandemen ? '' : 'disabled' %>>
                      <option value="">Pilih tipe</option>
                      <option value="murni" <%= kontrak.type == 'murni' ? 'selected' : '' %>>Murni</option>
                      <option value="turunan" <%= kontrak.type == 'turunan' ? 'selected' : '' %>>Turunan</option>
                    </select>
                    <% if(errors) { %>
                      <div class="text-danger mt-2 text-sm">
                        <%= errors.type %>
                      </div>
                    <% } %>
                  </div>

                  <hr>

                  <div class="mb-4">
                    <label for="" class="form-label">Versi Amandemen</label>
                    <input type="text" class="form-control" value="<%= kontrak.versi_amandemen %>" disabled>
                  </div>
    
                  <hr>
    
                  <div class="d-flex justify-content-end">
                    <% if (kontrak.is_amandemen) { %>
                      <button class="btn btn-dark">Simpan</button>
                    <% } else { %>
                      <a href="/kontrak/<%= kontrak._id %>/amandemen">
                        <button type="button" class="btn btn-danger me-2" style="background-color: #ff4f70;">Amandemen</button>
                      </a>
                    <% } %>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include("../../_script") %>
    <script>
      $(document).ready(function() {
        $('#pengadaan-select2').select2({
          theme: "bootstrap-5",
          width: $( this ).data( 'width' ) ? $( this ).data( 'width' ) : $( this ).hasClass( 'w-100' ) ? '100%' : 'style',
          placeholder: $( this ).data( 'placeholder' ),
          ajax: {
            url: '/pengadaan/json',
            data: function (params) {
              var query = {
                search: params.term,
                type: 'public'
              }
              return query;
            },
            processResults: function (data) {
              return {
                results: data.data.map(function (item) {
                  return {
                    id: item._id,
                    text: item.nodin
                  }
                })
              };
            }
          }
        });
        
        // set initial value
        const initialData = {
          id: "<%= kontrak.pengadaan_id %>",
          text: "<%= kontrak.pengadaan.nodin %>"
        };
        const $select = $('#pengadaan-select2');
        const option = new Option(initialData.text, initialData.id, true, true);
        $select.append(option).trigger('change');
      });
    </script>
  </div>
</body>

</html>